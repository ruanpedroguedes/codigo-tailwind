{% extends 'base.html' %}
{% load static %}
{% load custom_tags %}
{% load static tailwind_tags %}
{% tailwind_css %}
{% load custom_tags %}


{% block content %}
<header class="flex items-center gap-3 p-4 sm:px-8 bg-white shadow-md">
  <a href="{% url 'events_list' %}" class="hover:opacity-80 transition">
    <img src="{% static 'icons/back.svg' %}" alt="Voltar" class="h-6 w-6">
  </a>
  <h1 class="text-xl sm:text-2xl font-semibold text-gray-800">Dashboard: {{ event.title }}</h1>
</header>

<main class="bg-gray-50 p-8 min-h-screen">

  <!-- Filtros -->
  <form method="get" class="mb-8">
    <div class="flex flex-wrap gap-4 items-end">
      <div class="flex flex-col min-w-[200px]">
        <label for="setor" class="mb-1 font-medium text-gray-700">Setor:</label>
        <select id="setor" name="setor" class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
          <option value="">Todos</option>
          {% for s in setores %}
            <option value="{{ s.id }}" {% if request.GET.setor == s.id|stringformat:"s" %}selected{% endif %}>
              {{ s.title }}
            </option>
          {% endfor %}
        </select>
      </div>
      <div>
        <button type="submit" class="bg-blue-600 text-white font-semibold px-5 py-2 rounded-md hover:bg-blue-700 transition">
          Filtrar
        </button>
      </div>
    </div>
  </form>

  <div class="flex flex-wrap gap-6 justify-between mb-8">

    <!-- Resumo -->
    <section class="bg-white p-6 rounded-2xl shadow-md flex-1 min-w-[320px]">
      <h2 class="text-lg font-bold mb-4 text-gray-900">Resumo de Ingressos</h2>
      <div class="flex flex-col gap-4">
        <div class="card available rounded-lg border-2 border-green-500 bg-green-50 p-4 text-center font-bold text-green-700 shadow-md min-h-[100px] flex flex-col justify-center">
          <div>Ingressos Disponíveis</div>
          <div class="text-2xl font-extrabold mt-1">{{ disponiveis }}</div>
        </div>
        <div class="card reserved rounded-lg border-2 border-red-500 bg-red-50 p-4 text-center font-bold text-red-600 shadow-md min-h-[100px] flex flex-col justify-center">
          <div>Ingressos Reservados</div>
          <div class="text-2xl font-extrabold mt-1">{{ emitidos }}</div>
        </div>
        <div class="card validated rounded-lg border-2 border-green-700 bg-green-100 p-4 text-center font-bold text-green-800 shadow-md min-h-[100px] flex flex-col justify-center">
          <div>Ingressos Validados</div>
          <div class="text-2xl font-extrabold mt-1">{{ validados }}</div>
        </div>
      </div>
    </section>

    <!-- Gráfico de Pizza - Disponíveis vs Reservados -->
    <section class="bg-white p-6 rounded-2xl shadow-md flex-1 min-w-[320px]">
      <h2 class="text-lg font-bold mb-4 text-gray-900">Distribuição de Ingressos</h2>
      <canvas id="pie" class="w-full max-w-full h-[400px]"></canvas>
    </section>

    <!-- Gráfico de Pizza - Status Geral -->
    <section class="bg-white p-6 rounded-2xl shadow-md flex-1 min-w-[320px]">
      <h2 class="text-lg font-bold mb-4 text-gray-900">Distribuição Geral por Checkin</h2>
      <canvas id="statusPie" class="w-full max-w-full h-[400px]"></canvas>
    </section>
  </div>

  <!-- Gráfico de Barras por Status por Setor -->
  

</main>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  new Chart(document.getElementById('pie'), {
    type: 'doughnut',
    data: {
      labels: ['% Disponíveis', '% Reservados'],
      datasets: [{
        label: 'Porcentagem',
        data: [{{ percent_disponiveis }}, {{ percent_emitidos }}],
        backgroundColor: ['#00CA07', '#F44528'],
        hoverOffset: 4
      }]
    }
  });

  new Chart(document.getElementById('statusPie'), {
    type: 'doughnut',
    data: {
      labels: ['Pendentes', 'Realizados'],
      datasets: [{
        data: [{{ total_pendentes }}, {{ total_realizados }}],
        backgroundColor: ['#F4C542', '#00A86B'],
        hoverOffset: 4
      }]
    }
  });


</script>
{% endblock %}
